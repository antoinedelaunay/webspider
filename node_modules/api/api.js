var app;
var PORT;

if(app !== undefined){
	app.get('/', function(req, res){r
		es.json(200, {
			title:'YOHMC - Your Own Home Made Crawler',
			endpoints:[{
				url:'http://127.0.0.1:'+PORT+'/queue/size',
				details:'the current crawler queue size'
			}, {
				url:'http://127.0.0.1:'+PORT+'/queue/add?url=http%3A//voila.fr',
				details:'immediately start a `get_page` on voila.fr.'
			}, {
				url:'http://127.0.0.1:'+PORT+'/queue/list',
				details:'the current crawler queue list.'
			}]
		});
	});
}

if(app !== undefined){
	app.get('/queue/size', function(req, res){
		res.setHeader('Content-Type', 'text/plain');
		res.json(200, {queue:{length:queue.length}});
	});
}

if(app !== undefined){
	app.get('/queue/add', function(req, res){
		var url = req.param('url');
		get_page(url);
		res.json(200, {
			queue:{
				added:url,
				length:queue.length,
			}
		});
	});
}

if(app !== undefined){
	app.get('/queue/list', function(req, res){
		res.json(200, {
			queue:{
				length:queue.length,
				urls:queue
			}
		});
	});
}


var appX = function(app) {
  return app = app;
};

module.exports.appX = appX;
module.exports.app = app;

if(PORT !== undefined){
	app.listen(PORT);
}